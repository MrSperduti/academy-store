<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Checkout - ACADEMY STORE</title>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script>
    window.onload = function () {
      emailjs.init("6UvRqFZl_DySz_084");
    };
  </script>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>Checkout</h1>
    <nav><a href="prodotti.html">üîô Torna al catalogo</a></nav>
  </header>
  <main>
    <form id="checkout-form" style="max-width: 400px; margin: auto;" onsubmit="inviaOrdine(); return false;">
      <label>Nome:<br><input type="text" id="nome" required></label><br><br>
      <label>Cognome:<br><input type="text" id="cognome" required></label><br><br>
      <label>Data di nascita:<br><input type="date" id="datanascita" required></label><br><br>
      <label>Email:<br><input type="email" id="email" required></label><br><br>
      
      <!-- Nuovo campo per modifica scritta -->
      <label>Modifica la scritta esistente:<br>
        <input type="text" id="modificaScritta" placeholder="Scrivi qui la modifica">
      </label><br><br>
      
      <!-- Nuovo campo per aggiunta scritta -->
      <label>Aggiungi una scritta personalizzata:<br>
        <input type="text" id="aggiungiScritta" placeholder="Scrivi la scritta da aggiungere">
      </label><br><br>
      
      <!-- Selezione fronte o retro -->
      <label>Dove vuoi la personalizzazione?<br>
        <select id="posizioneScritta">
          <option value="fronte">Fronte</option>
          <option value="retro">Retro</option>
        </select>
      </label><br><br>

      <label>Descrivi come vuoi la tua personalizzazione:</label><br>
      <textarea id="note" rows="4" placeholder="Scrivi qui le istruzioni per la personalizzazione..."></textarea><br><br>

      <button type="submit">üì© Invia ordine</button>
    </form>
    <pre id="debug-output" style="margin-top:20px; background:#eee; padding:10px;"></pre>
  </main>
  <script>
    function generaRiepilogoCarrello() {
      const carrello = JSON.parse(localStorage.getItem("carrello")) || [];
      if (carrello.length === 0) return "Carrello vuoto.";
      return carrello.map(p => {
        return `üîπ ${p.nome}
  ${p.taglia ? "- Taglia: " + p.taglia : ""}
  ${p.colore ? "- Colore: " + p.colore : ""}
  - Quantit√†: ${p.quantita}
  - Prezzo: ‚Ç¨${(p.prezzo).toFixed(2)}
  - Subtotale: ‚Ç¨${(p.prezzo * p.quantita).toFixed(2)}
`;
      }).join("\n");
    }

    function inviaOrdine() {
      const templateParams = {
        nome: document.getElementById("nome").value,
        cognome: document.getElementById("cognome").value,
        datanascita: document.getElementById("datanascita").value,
        email: document.getElementById("email").value,
        modificaScritta: document.getElementById("modificaScritta").value,
        aggiungiScritta: document.getElementById("aggiungiScritta").value,
        posizioneScritta: document.getElementById("posizioneScritta").value,
        note: document.getElementById("note").value,
        carrello: generaRiepilogoCarrello()
      };

      emailjs.send("service_px4g8mw", "template_qeoslbr", templateParams)
        .then(response => {
          document.getElementById("debug-output").textContent = "‚úÖ Ordine inviato con successo! Grazie per aver ordinato con ACADEMY STORE.\nPotrai ritirare il tuo ordine presso il nostro store in via Venezia 128, Ardea.\nRiceverai una mail quando sar√† pronto.";
          localStorage.removeItem("carrello"); window.location.href = "ordine-completato.html";
        }, error => {
          document.getElementById("debug-output").textContent = "‚ùå Errore durante l'invio:\n" + JSON.stringify(error, null, 2);
        });
    }
  </script>
</body>
</html>
