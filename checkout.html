
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Checkout - ACADEMY STORE</title>
  <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
  <script>
    (function(){
      emailjs.init("6UvRqFZl_DySz_084");
    })();
  </script>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>Checkout</h1>
    <nav>
      <a href="prodotti.html">üîô Torna al catalogo</a>
    </nav>
  </header>
  <main>
    <form id="checkout-form" style="max-width: 400px; margin: auto;" onsubmit="inviaOrdine(); return false;">
      <label>Nome:<br><input type="text" name="nome" id="nome" required></label><br><br>
      <label>Cognome:<br><input type="text" name="cognome" id="cognome" required></label><br><br>
      <label>Data di nascita:<br><input type="date" name="datanascita" id="datanascita" required></label><br><br>
      <label>Email:<br><input type="email" name="email" id="email" required></label><br><br>
      <label>Note:<br><textarea name="note" id="note" rows="4"></textarea></label><br><br>
      <button type="submit">üì© Invia ordine</button>
    </form>
    <p id="risultato" style="text-align:center;margin-top:20px;color:green;"></p>
  </main>

  <script>
    function generaRiepilogoCarrello() {
      const carrello = JSON.parse(localStorage.getItem("carrello")) || [];
      if (carrello.length === 0) return "Carrello vuoto.";

      let riepilogo = "";
      carrello.forEach((p, i) => {
        riepilogo += `üîπ ${p.nome}\n`;
        if (p.taglia) riepilogo += ` - Taglia: ${p.taglia}\n`;
        if (p.colore) riepilogo += ` - Colore: ${p.colore}\n`;
        riepilogo += ` - Quantit√†: ${p.quantita}\n`;
        riepilogo += ` - Prezzo: ‚Ç¨${(p.prezzo).toFixed(2)}\n`;
        riepilogo += ` - Subtotale: ‚Ç¨${(p.prezzo * p.quantita).toFixed(2)}\n\n`;
      });
      return riepilogo;
    }

    function inviaOrdine() {
      const nome = document.getElementById("nome").value;
      const cognome = document.getElementById("cognome").value;
      const datanascita = document.getElementById("datanascita").value;
      const email = document.getElementById("email").value;
      const note = document.getElementById("note").value;
      const carrelloText = generaRiepilogoCarrello();

      const templateParams = {
        nome: nome,
        cognome: cognome,
        datanascita: datanascita,
        email: email,
        note: note,
        carrello: carrelloText
      };

      emailjs.send("service_px4g8mw", "template_ior7q1p", templateParams)
        .then(function(response) {
          document.getElementById("risultato").textContent = "‚úÖ Ordine inviato con successo!";
          localStorage.removeItem("carrello");
        }, function(error) {
          document.getElementById("risultato").textContent = "‚ùå Errore durante l'invio.";
        });
    }
  </script>
</body>
</html>
